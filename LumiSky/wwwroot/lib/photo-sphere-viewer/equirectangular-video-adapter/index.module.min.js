/**
 * Minified by jsDelivr using Terser v5.37.0.
 * Original file: /npm/@photo-sphere-viewer/equirectangular-video-adapter@5.11.4/index.module.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
/*!
 * Photo Sphere Viewer / Equirectangular Video Adapter 5.11.4
 * @copyright 2015-2024 Damien "Mistic" Sorel
 * @licence MIT (https://opensource.org/licenses/MIT)
 */
import{EquirectangularAdapter,utils}from"@photo-sphere-viewer/core";import{AbstractAdapter,PSVError}from"@photo-sphere-viewer/core";import{VideoTexture}from"three";function createVideo({src:e,withCredentials:t,muted:r,autoplay:i}){const o=document.createElement("video");return o.crossOrigin=t?"use-credentials":"anonymous",o.loop=!0,o.playsInline=!0,o.autoplay=i,o.muted=r,o.preload="metadata",e instanceof MediaStream?o.srcObject=e:o.src=e,o}var AbstractVideoAdapter=class extends AbstractAdapter{constructor(e){super(e)}init(){super.init(),this.viewer.needsContinuousUpdate(!0)}destroy(){this.__removeVideo(),super.destroy()}supportsPreload(){return!1}supportsTransition(){return!1}async loadTexture(e){if("object"!=typeof e||!e.source)return Promise.reject(new PSVError("Invalid panorama configuration, are you using the right adapter?"));if(!this.viewer.getPlugin("video"))return Promise.reject(new PSVError("Video adapters require VideoPlugin to be loaded too."));const t=e.source instanceof HTMLVideoElement?e.source:createVideo({src:e.source,withCredentials:this.viewer.config.withCredentials,muted:this.config.muted,autoplay:!1});await this.__videoLoadPromise(t);return{panorama:e,texture:new VideoTexture(t)}}switchVideo(e){let t,r,i=!this.config.autoplay,o=this.config.muted,a=1;this.video&&({currentTime:t,duration:r,paused:i,muted:o,volume:a}=this.video),this.__removeVideo(),this.video=e.image,this.video.duration===r&&(this.video.currentTime=t),this.video.muted=o,this.video.volume=a,i||this.video.play()}setTextureOpacity(e,t){e.material.opacity=t,e.material.transparent=t<1}disposeTexture({texture:e}){e.dispose()}disposeMesh(e){e.geometry.dispose(),e.material.dispose()}__removeVideo(){this.video&&(this.video.pause(),this.video.remove(),delete this.video)}__videoLoadPromise(e){return new Promise(((t,r)=>{const i=()=>{this.video&&e.duration===this.video.duration?t(this.__videoBufferPromise(e,this.video.currentTime)):t(),e.removeEventListener("loadedmetadata",i)},o=t=>{r(t),e.removeEventListener("error",o)};e.addEventListener("loadedmetadata",i),e.addEventListener("error",o)}))}__videoBufferPromise(e,t){return new Promise((r=>{function i(){const t=e.buffered;for(let o=0,a=t.length;o<a;o++)if(t.start(o)<=e.currentTime&&t.end(o)>=e.currentTime){e.pause(),e.removeEventListener("buffer",i),e.removeEventListener("progress",i),r();break}}e.currentTime=Math.min(t+2e3,e.duration),e.muted=!0,e.addEventListener("buffer",i),e.addEventListener("progress",i),e.play()}))}};AbstractVideoAdapter.supportsDownload=!1;var getConfig=utils.getConfigParser({resolution:64,autoplay:!1,muted:!1}),EquirectangularVideoAdapter=class extends AbstractVideoAdapter{constructor(e,t){super(e),this.config=getConfig(t),this.adapter=new EquirectangularAdapter(this.viewer,{resolution:this.config.resolution})}destroy(){this.adapter.destroy(),delete this.adapter,super.destroy()}textureCoordsToSphericalCoords(e,t){return this.adapter.textureCoordsToSphericalCoords(e,t)}sphericalCoordsToTextureCoords(e,t){return this.adapter.sphericalCoordsToTextureCoords(e,t)}async loadTexture(e,t,r){const{texture:i}=await super.loadTexture(e),o=i.image;e.data&&(r=e.data),"function"==typeof r&&(r=r(o));return{panorama:e,texture:i,panoData:utils.mergePanoData(o.videoWidth,o.videoHeight,r)}}createMesh(e){return this.adapter.createMesh(e)}setTexture(e,{texture:t}){e.material.map=t,this.switchVideo(t)}};EquirectangularVideoAdapter.id="equirectangular-video",EquirectangularVideoAdapter.VERSION="5.11.4";export{EquirectangularVideoAdapter};
//# sourceMappingURL=/sm/03d2427a1bc1035fd99e7e15ee90d440c38ae01d85a122cf979614d36034b540.map